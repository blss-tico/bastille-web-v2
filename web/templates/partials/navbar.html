{{define "navbar"}}  
  <header class="navbar container-fluid">
    <nav>
      <ul>        
        <li>
          <img src="/static/logo.png" width="25px" height="25px" />
          <strong>BASTILLE-WEB</strong>
        </li>
      </ul>
      <ul>
        <li>
          <button id="themeToggle" data-tooltip="change theme" data-placement="bottom">ðŸŒ™</button>
        </li>
        <li>
          <button id="notifToggle" data-tooltip="notifications" data-placement="bottom">ðŸ””</button>
        </li>
        <li>
          <button id="logoutBtn" data-tooltip="logout" data-placement="bottom" onclick="logout()">âžœ]</button>
        </li>
        <li>
          <button id="sidebarToggle" class="sidebar-toggle" data-tooltip="menu" data-placement="bottom">â˜°</button>
        </li>
      </ul>
    </nav>
    
    <div id="notifications" class="notifications">
      <ul id="notification-list"></ul>
    </div>
  </header>

  <script>
    console.log('[info]: Navbar page');

    // Dark mode toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      themeToggle.textContent = next === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', next);
    });

    // Restore theme preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.documentElement.setAttribute('data-theme', savedTheme);
      themeToggle.textContent = savedTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
    }

    // Notifications toggle
    const notifToggle = document.getElementById('notifToggle');
    const notifications = document.getElementById('notifications');
    notifToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      notifications.classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
      if (!notifications.contains(e.target) && e.target !== notifToggle) {
        notifications.classList.remove('show');
      }
    });
    
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { notifications.classList.remove('show'); }
    });

    const bell = document.getElementById('notifToggle');

    document.addEventListener("notification", (e) => {       
      const { message } = e.detail;

      const hasClass = bell.classList.contains('blink');
      if (!hasClass) { bell.classList.add("blink"); }
      else { bell.classList.toggle('blink'); }      
      
      addNewNotification(message);
    }, false);

    function addNewNotification(notification) {
      console.log("[info]: addNewNotification navbar");

      const list = document.getElementById("notification-list");
      const newItem = document.createElement("li");
      newItem.textContent = notification;
      list.appendChild(newItem);

      setTimeout(() => bell.classList.toggle('blink'), 3000);
    }

    async function logout() {
      const response = await sendHttpRequest("logout", JSON.stringify({}));
      if (response.code == 200) {        
        sessionStorage.setItem('bw_actk', response.data.bw_actk);
        sessionStorage.setItem('bw_rftk', response.data.bw_rftk);
      } 
      
      sessionStorage.removeItem('hostname');
      sessionStorage.removeItem('id');
      sessionStorage.removeItem('jails');
      sessionStorage.removeItem('hostJail');
      sessionStorage.removeItem('ipaddr');
      sessionStorage.removeItem('port');
      sessionStorage.removeItem('bw_actk');
      sessionStorage.removeItem('bw_rftk');

      window.location.href = '/';
    }
  </script>
{{end}}
